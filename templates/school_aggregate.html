{% extends "layout.html" %}
{% load humanize %}
    {% block title %}Stacked Up | {{ school.name.title }} | AxisPhilly{% endblock %}
    {% block ogtitle %}Stacked Up | {{ school.name.title }} | AxisPhilly{% endblock %}
    {% block content %}
        <div class="container content-inner">
            <div class="section row mbn mtm">
                <h1 id="headline" class="left">{{ school.name.title }}</h1>
                                <!-- AddThis Button BEGIN -->
                <div class="addthis_toolbox addthis_default_style right mts">
                <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
                <a class="addthis_button_tweet"></a>
                <a class="addthis_button_pinterest_pinit"></a>
                <a class="addthis_counter addthis_pill_style"></a>
                </div>
                <!-- AddThis Button END -->
            </div>
            <div class="section row">
                <div class="col twelve mobile-full" id="graph-sidebar">        
                    <div class="col six mobile-full">        
                        <div class="h3">What's here?</div>
                        <p>Below is inventory data about the reading and math programs at {{ school.name.title }}. For each subject, a curriculum is displayed if there is some evidence of that curriculum in the school's inventory.</p>
                        <p>The materials displayed for each curriculum are those deemed to likely to be necessary for students in a classroom. Some materials have "No records" displayed as the quantity, meaning that while the material is common for the curriculum, it is not recorded at all in the school's inventory.</p>
                    </div>
                    <div class="col six mobile-full">
                        <div class="h3">How to use this tool</div>
                        <img src="{{ STATIC_URL }}images/needed.png" style="float: right; margin-left: 10px"><p>For each curriculum, you'll see the common materials needed for students along with the cost to close the gap for the number of needed materials. By changing the "Needed Materials" column, you'll see that the number of materials needed for that curriculum changes, as does the price to close the gap.</p>
                    </div>
                </div>
            </div>
            <div class="section row">
                <div class="col twelve mobile-full">            
                    <div class="grade-listing">
                        <h3 id="inventory-selector" class="mbn">Inventory for Grade: 
                            {% for grade in grades %}
                                {% if current_grade == grade.human_grade %}
                                    <span class="selected grade strong">
                                        {{ grade.human_grade }}
                                    </span>
                                {% else %}
                                <span class="unselected grade">                                
                                    <a href="/school/{{school.school_code}}/{{grade.grade_level}}">
                                        {{ grade.human_grade }}
                                    </a>
                                </span>
                                {% endif %}
                            {% endfor %}
                            <a href="/school/inventory/{{ school.school_code }}" id="full-inventory" class="right mrm mts">View full inventory for this school</a>
                        </h3>
                    </div>
                    <div>
                        {% if curriculum_list %}                         
                            {% for subject, value in curriculum_list.items %}
                                <div class="subject-intro">
                                    <div class="scores-container">
                                        <div id="{{ subject }}-scores"></div>
                                        <div id="{{ subject }}-chart-title" class="chart-title"></div>
                                    </div>
                                </div>
                                <h2 class="subject-title">{{ subject.title }}</h2>
                                {% if value.curricula.items %}
                                    {% for title, grade_curriculum in value.curricula.items %}
                                    <div class="block">
                                        <h3 class="curriculum-title">{% if grade_curriculum.likely_curriculum %}<img class="left mrm tooltip" src="{{ STATIC_URL }}images/book-icon-blue.png" height="20" style="margin-top: 4px" title="Inventory records suggest that this curriculum is mostly likely being used at this school. Is it?">{% endif %}{{ title }}</h3>
                                    </div>
                                    <table class="tablesorter">
                                        <thead>
                                            <tr>
                                                <th class="tooltip" title="Titles are gathered from curriculum ordering documents available to the school district.">
                                                    Material
                                                    <span class="tooltip-icon"></span>
                                                </th>
                                                <th>
                                                    Price / Material
                                                </th>                                                
                                                <th>
                                                    Recorded Inventory
                                                </th>
                                                <th class="tooltip" title="The default number of needed materials is set to the number of students in this grade in '12â€“'13. You can change the number of needed materials by using the arrows below.">
                                                    Needed Materials
                                                    <span class="tooltip-icon"></span>
                                                </th>
                                                <th>
                                                    Difference
                                                </th>
                                                <th>
                                                    Enough
                                                </th>
                                            </tr> 
                                        </thead>
                                        <tbody>
                                        {% for material in grade_curriculum.necessary_material %}
                                            <tr>
                                                <td>
                                                    {{ material.title }}
                                                </td>
                                                <td>
                                                    ${{ material.cost }}
                                                </td>                                                
                                                <td>
                                                    {{ material.total_copies }}
                                                </td>       
                                                <td class="needed-material">
                                                    <input value="{{ material.needed }}" type="number" class="change-input">
                                                </td>       
                                                <td class="material-difference" data-original-difference="{{ material.numerical_difference }}" data-material-pk="{{material.pk}}">
                                                    {{ material.difference }}
                                                    </td>       
                                                <td class="{% if material.enough == 'True' %}enough{% else %}notEnough{% endif %}">
                                                    <span class="icon">{% if material.enough == 'True' %}1{% else %}-1{% endif %}</span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                    <div class="block shortfall-detail">
                                        <p>It would cost 
                                            <span class="shortfall-cost" data-original-cost="{{grade_curriculum.cost_shortfall}}"><strong>${{ grade_curriculum.cost_shortfall|floatformat:2|intcomma }}</strong></span>
                                            to purchase the 
                                            <span class="shortfall-count" data-original-count="{{ grade_curriculum.book_shortfall }}"><strong>{{ grade_curriculum.book_shortfall }}</strong></span> missing materials listed below for the students in grade {{ current_grade }} at {{ school.name.title }}. This does not take into account possible redistribution from other schools or the school district. You can <strong>change the number of needed materials</strong> by using the arrows above.</p>
                                        <hr>
                                    </div>                                    
                                {% endfor %}
                            {% else %}
                                <p class="no-match">We didn't find any inventory records at this school that matched an approved curriculum for this subject in this grade. <a href="/school/inventory/{{ school.school_code }}">View all inventory records at this school</a>.</p>
                                <hr>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <p>No inventory</p>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endblock %}

{% block scripts %}
<script type="text/javascript">
var grade = "{{ current_grade }}";
if(grade === "K") { grade = 0 };

app.getChartData({{ school.pk }}, grade);
</script>
{% endblock %}